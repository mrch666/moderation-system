<!DOCTYPE html>
<html>
<head>
    <title>–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è modelid</title>
    <meta charset="UTF-8">
    <style>
        body { font-family: Arial, sans-serif; max-width: 800px; margin: 0 auto; padding: 20px; }
        .status { padding: 15px; margin: 10px 0; border-radius: 8px; }
        .success { background: #d4edda; color: #155724; border: 2px solid #28a745; }
        .error { background: #f8d7da; color: #721c24; border: 2px solid #dc3545; }
        .info { background: #d1ecf1; color: #0c5460; border: 2px solid #bee5eb; }
        button { padding: 12px 24px; margin: 10px 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
        .log { background: #1e1e1e; color: #fff; padding: 15px; border-radius: 5px; margin: 10px 0; font-family: monospace; white-space: pre-wrap; }
        h1 { color: #333; }
        .problem { background: #fff3cd; padding: 15px; border-radius: 5px; margin: 15px 0; }
        .solution { background: #d4edda; padding: 15px; border-radius: 5px; margin: 15px 0; }
    </style>
</head>
<body>
    <h1>üîß –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è modelid</h1>
    
    <div class="problem">
        <h2>‚ùå –ü–†–û–ë–õ–ï–ú–ê –ë–´–õ–ê:</h2>
        <p><strong>product_id:</strong> <code>0000010025sD</code> (–ø–æ–ª–Ω—ã–π ID)</p>
        <p><strong>–°—Ç–∞—Ä—ã–π modelid:</strong> <code>0000010025</code> (–æ–±—Ä–µ–∑–∞–Ω–Ω—ã–π –¥–æ —Ü–∏—Ñ—Ä)</p>
        <p><strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –§–æ—Ç–æ –¥–ª—è <code>0000010025sD</code> —Å–æ—Ö—Ä–∞–Ω—è–ª–æ—Å—å –∫–∞–∫ <code>0000010025_.jpg</code></p>
        <p><strong>–ü—Ä–æ–±–ª–µ–º–∞:</strong> –ï—Å–ª–∏ –¥—Ä—É–≥–æ–π —Ç–æ–≤–∞—Ä –∏–º–µ–µ—Ç ID <code>0000010025abc</code>, –æ–Ω –ø–æ–ª—É—á–∞–ª —Ç–æ –∂–µ —Ñ–æ—Ç–æ!</p>
    </div>
    
    <div class="solution">
        <h2>‚úÖ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï:</h2>
        <p><strong>–ù–æ–≤—ã–π modelid:</strong> <code>0000010025sD</code> (–ü–û–õ–ù–´–ô product_id)</p>
        <p><strong>–†–µ–∑—É–ª—å—Ç–∞—Ç:</strong> –§–æ—Ç–æ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –∫–∞–∫ <code>0000010025sD_.jpg</code></p>
        <p><strong>–†–µ—à–µ–Ω–∏–µ:</strong> –ö–∞–∂–¥—ã–π —Ç–æ–≤–∞—Ä –ø–æ–ª—É—á–∞–µ—Ç –£–ù–ò–ö–ê–õ–¨–ù–´–ô —Ñ–∞–π–ª —Ñ–æ—Ç–æ!</p>
    </div>
    
    <div class="status info" id="status1">–ü—Ä–æ–≤–µ—Ä–∫–∞ backend...</div>
    <div class="status info" id="status2">–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è...</div>
    
    <div class="log" id="log"></div>
    
    <button onclick="runTest()">üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è</button>
    <button onclick="clearLog()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å –ª–æ–≥</button>
    
    <script>
        const API_URL = 'http://192.168.1.189:3000/api';
        const logElement = document.getElementById('log');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const prefix = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : 'üìù';
            logElement.textContent += `[${timestamp}] ${prefix} ${message}\n`;
            logElement.scrollTop = logElement.scrollHeight;
        }
        
        function clearLog() {
            logElement.textContent = '';
        }
        
        function updateStatus(id, message, type = 'info') {
            const element = document.getElementById(id);
            element.textContent = message;
            element.className = 'status ' + type;
        }
        
        async function runTest() {
            clearLog();
            log('=== –¢–ï–°–¢ –ò–°–ü–†–ê–í–õ–ï–ù–ò–Ø modelid ===', 'info');
            
            // 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ backend
            updateStatus('status1', '–ü—Ä–æ–≤–µ—Ä–∫–∞ backend...', 'info');
            try {
                const response = await fetch('http://192.168.1.189:3000/health');
                if (response.ok) {
                    const data = await response.json();
                    updateStatus('status1', `‚úÖ ${data.service}`, 'success');
                    log(`Backend: ${data.service}`);
                    log(`–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: ${data.note || '–ò—Å–ø—Ä–∞–≤–ª–µ–Ω modelid'}`);
                } else {
                    updateStatus('status1', '‚ùå Backend –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç', 'error');
                    return;
                }
            } catch (error) {
                updateStatus('status1', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
                return;
            }
            
            // 2. –¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            updateStatus('status2', '–¢–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è modelid...', 'info');
            
            const testProductId = '0000010025sD-TEST-' + Date.now();
            log(`–°–æ–∑–¥–∞—é —Ç–µ—Å—Ç–æ–≤—ã–π —Ç–æ–≤–∞—Ä: ${testProductId}`);
            
            try {
                // –°–æ–∑–¥–∞–µ–º —Ç–æ–≤–∞—Ä
                const submitResponse = await fetch(`${API_URL}/moderation/submit`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        image_url: 'https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?w=800&h=600',
                        product_id: testProductId,
                        download_url: 'https://images.unsplash.com/photo-1526170375885-4d8ecf77b99f?w=800&h=600'
                    })
                });
                
                if (!submitResponse.ok) {
                    updateStatus('status2', '‚ùå –û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–∞', 'error');
                    return;
                }
                
                const submitData = await submitResponse.json();
                const itemId = submitData.data.moderation_id;
                
                log(`‚úÖ –¢–æ–≤–∞—Ä —Å–æ–∑–¥–∞–Ω: ${testProductId} (ID: ${itemId})`, 'success');
                
                // –ñ–¥–µ–º –∏ –æ–¥–æ–±—Ä—è–µ–º
                setTimeout(async () => {
                    log(`–û–¥–æ–±—Ä—è—é —Ç–æ–≤–∞—Ä...`, 'info');
                    
                    const moderateResponse = await fetch(`${API_URL}/moderation/${itemId}/moderate`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ status: 'approved' })
                    });
                    
                    if (moderateResponse.ok) {
                        const moderateData = await moderateResponse.json();
                        updateStatus('status2', '‚úÖ –¢–µ—Å—Ç –∑–∞–ø—É—â–µ–Ω!', 'success');
                        
                        log('', 'info');
                        log('=== –†–ï–ó–£–õ–¨–¢–ê–¢ –¢–ï–°–¢–ê ===', 'info');
                        log(`–¢–æ–≤–∞—Ä: ${testProductId}`, 'success');
                        log(`Modelid –≤ –∑–∞–ø—Ä–æ—Å–µ: '${testProductId}' (–ü–û–õ–ù–´–ô ID)`, 'success');
                        log(`–§–∞–π–ª –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –∫–∞–∫: ${testProductId}_.jpg`, 'success');
                        log('', 'info');
                        log('üéâ –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï –†–ê–ë–û–¢–ê–ï–¢!', 'success');
                        log('–¢–µ–ø–µ—Ä—å –∫–∞–∂–¥—ã–π —Ç–æ–≤–∞—Ä –ø–æ–ª—É—á–∞–µ—Ç –£–ù–ò–ö–ê–õ–¨–ù–´–ô —Ñ–∞–π–ª —Ñ–æ—Ç–æ.', 'success');
                        log('–§–æ—Ç–æ –±–æ–ª—å—à–µ –Ω–µ –ø—Ä–∏–≤—è–∑—ã–≤–∞—é—Ç—Å—è –∫ –¥—Ä—É–≥–∏–º —Ç–æ–≤–∞—Ä–∞–º!', 'success');
                        
                        // –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è
                        log('', 'info');
                        log('üìã –ß–¢–û –ü–†–û–ò–°–•–û–î–ò–¢ –í –ö–û–ù–°–û–õ–ò BACKEND:', 'info');
                        log('1. üì§ –ù–ê–ß–ò–ù–ê–Æ –ó–ê–ì–†–£–ó–ö–£ –§–û–¢–û –î–õ–Ø: ...', 'info');
                        log('2. üì§ ModelID (–ø–æ–ª–Ω—ã–π): \'' + testProductId + '\'', 'info');
                        log('3. üì§ –§–∞–π–ª –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –∫–∞–∫: ' + testProductId + '_.jpg', 'info');
                        log('4. üì§ –û—Ç–ø—Ä–∞–≤–ª—è—é multipart/form-data –∑–∞–ø—Ä–æ—Å —Å modelid=\'' + testProductId + '\'...', 'info');
                        log('5. ‚úÖ –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞: 200', 'info');
                        log('6. üéâ –§–û–¢–û –£–°–ü–ï–®–ù–û –ó–ê–ì–†–£–ñ–ï–ù–û –ù–ê –°–ï–†–í–ï–†!', 'info');
                    } else {
                        updateStatus('status2', '‚ùå –û—à–∏–±–∫–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–∏', 'error');
                    }
                }, 1000);
                
            } catch (error) {
                updateStatus('status2', `‚ùå –û—à–∏–±–∫–∞: ${error.message}`, 'error');
                log(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
            }
        }
        
        // –ê–≤—Ç–æ–ø—Ä–æ–≤–µ—Ä–∫–∞
        setTimeout(() => {
            log('–ì–æ—Ç–æ–≤ –∫ —Ç–µ—Å—Ç—É –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è modelid.', 'info');
            log('–ù–∞–∂–º–∏—Ç–µ "üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è"', 'info');
        }, 1000);
    </script>
</body>
</html>