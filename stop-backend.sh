#!/bin/bash

echo "üõë –û–°–¢–ê–ù–û–í–ö–ê BACKEND –°–ò–°–¢–ï–ú–´ –ú–û–î–ï–†–ê–¶–ò–ò"
echo "====================================="

# –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –≤—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã —Å–∏—Å—Ç–µ–º—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏
echo "–ò—â—É –ø—Ä–æ—Ü–µ—Å—Å—ã —Å–∏—Å—Ç–µ–º—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏..."
PROCESSES=$(ps aux | grep -E "node.*simple-index" | grep -v grep)

if [ -z "$PROCESSES" ]; then
    echo "‚úÖ –ü—Ä–æ—Ü–µ—Å—Å—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã - —Å–∏—Å—Ç–µ–º–∞ –Ω–µ –∑–∞–ø—É—â–µ–Ω–∞"
else
    echo "–ù–∞–π–¥–µ–Ω—ã –ø—Ä–æ—Ü–µ—Å—Å—ã:"
    echo "$PROCESSES"
    
    # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø—Ä–æ—Ü–µ—Å—Å—ã
    pkill -f "node.*simple-index" 2>/dev/null
    echo "‚úÖ –í—Å–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã"
    
    # –î–∞–µ–º –≤—Ä–µ–º—è –Ω–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ
    sleep 2
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ –ø—Ä–æ—Ü–µ—Å—Å—ã –æ—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å
    if ps aux | grep -E "node.*simple-index" | grep -v grep >/dev/null; then
        echo "‚ö†Ô∏è  –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã –≤—Å–µ –µ—â–µ —Ä–∞–±–æ—Ç–∞—é—Ç. –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–∞—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∞..."
        pkill -9 -f "node.*simple-index" 2>/dev/null
    fi
fi

echo ""
echo "üìã –°–¢–ê–¢–£–° –ü–û–†–¢–û–í:"
echo "   –ü–æ—Ä—Ç 3000 (backend): $(netstat -tln 2>/dev/null | grep :3000 >/dev/null && echo "‚ùå –ó–∞–Ω—è—Ç" || echo "‚úÖ –°–≤–æ–±–æ–¥–µ–Ω")"
echo "   –ü–æ—Ä—Ç 8080 (frontend): $(netstat -tln 2>/dev/null | grep :8080 >/dev/null && echo "‚ùå –ó–∞–Ω—è—Ç" || echo "‚úÖ –°–≤–æ–±–æ–¥–µ–Ω")"

echo ""
echo "‚úÖ –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∞"