<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Backend</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test { margin: 10px 0; padding: 10px; border: 1px solid #ccc; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .loading { background: #fff3cd; border-color: #ffeaa7; }
        button { padding: 10px 20px; margin: 5px; }
    </style>
</head>
<body>
    <h1>üîß –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ Backend —Å–∏—Å—Ç–µ–º—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏</h1>
    
    <div class="test" id="test1">
        <h3>1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Backend</h3>
        <p>URL: <code id="url1">http://192.168.1.189:3000/health</code></p>
        <button onclick="testHealth()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç</button>
        <div id="result1"></div>
    </div>
    
    <div class="test" id="test2">
        <h3>2. –ü—Ä–æ–≤–µ—Ä–∫–∞ API —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (—Å API –∫–ª—é—á–æ–º)</h3>
        <p>URL: <code id="url2">http://192.168.1.189:3000/api/moderation/stats</code></p>
        <p>API –∫–ª—é—á: <code>test_api_key_123456</code></p>
        <button onclick="testStats()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç</button>
        <div id="result2"></div>
    </div>
    
    <div class="test" id="test3">
        <h3>3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—á–µ—Ä–µ–¥–∏ –º–æ–¥–µ—Ä–∞—Ü–∏–∏</h3>
        <p>URL: <code id="url3">http://192.168.1.189:3000/api/moderation/queue?limit=3</code></p>
        <button onclick="testQueue()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç</button>
        <div id="result3"></div>
    </div>
    
    <div class="test" id="test4">
        <h3>4. –ü—Ä–æ–≤–µ—Ä–∫–∞ CORS (–∫—Ä–æ—Å—Å-–¥–æ–º–µ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã)</h3>
        <p>–ü—Ä–æ–≤–µ—Ä—è–µ–º –º–æ–∂–Ω–æ –ª–∏ –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã —Å —ç—Ç–æ–≥–æ –¥–æ–º–µ–Ω–∞</p>
        <button onclick="testCors()">–ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç</button>
        <div id="result4"></div>
    </div>
    
    <div id="summary" style="margin-top: 20px; padding: 15px; border: 2px solid #333;">
        <h2>üìä –ò—Ç–æ–≥–æ–≤—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:</h2>
        <p id="summaryText">–¢–µ—Å—Ç—ã –Ω–µ –∑–∞–ø—É—â–µ–Ω—ã</p>
    </div>
    
    <script>
        const API_URL = 'http://192.168.1.189:3000';
        const API_KEY = 'test_api_key_123456';
        
        function setResult(elementId, success, message, data = null) {
            const element = document.getElementById(elementId);
            const resultDiv = element.querySelector('#result' + elementId.slice(-1)) || element;
            
            resultDiv.innerHTML = `
                <p><strong>${success ? '‚úÖ –£–°–ü–ï–•' : '‚ùå –û–®–ò–ë–ö–ê'}:</strong> ${message}</p>
                ${data ? `<pre style="background: #f5f5f5; padding: 10px; overflow: auto;">${JSON.stringify(data, null, 2)}</pre>` : ''}
            `;
            
            element.className = 'test ' + (success ? 'success' : 'error');
            updateSummary();
        }
        
        function setLoading(elementId, message) {
            const element = document.getElementById(elementId);
            const resultDiv = element.querySelector('#result' + elementId.slice(-1)) || element;
            resultDiv.innerHTML = `<p>‚è≥ ${message}...</p>`;
            element.className = 'test loading';
        }
        
        async function testHealth() {
            setLoading('test1', '–ü—Ä–æ–≤–µ—Ä—è–µ–º health endpoint');
            try {
                const response = await fetch(`${API_URL}/health`);
                if (response.ok) {
                    const data = await response.json();
                    setResult('test1', true, `Backend —Ä–∞–±–æ—Ç–∞–µ—Ç! –°—Ç–∞—Ç—É—Å: ${data.status}`, data);
                } else {
                    setResult('test1', false, `–û—à–∏–±–∫–∞ HTTP: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                setResult('test1', false, `–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`);
            }
        }
        
        async function testStats() {
            setLoading('test2', '–ü—Ä–æ–≤–µ—Ä—è–µ–º —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É');
            try {
                const response = await fetch(`${API_URL}/api/moderation/stats`, {
                    headers: {
                        'X-API-Key': API_KEY
                    }
                });
                if (response.ok) {
                    const data = await response.json();
                    setResult('test2', true, `–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–ª—É—á–µ–Ω–∞! –£—Å–ø–µ—Ö: ${data.success}`, data);
                } else {
                    setResult('test2', false, `–û—à–∏–±–∫–∞ HTTP: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                setResult('test2', false, `–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`);
            }
        }
        
        async function testQueue() {
            setLoading('test3', '–ü—Ä–æ–≤–µ—Ä—è–µ–º –æ—á–µ—Ä–µ–¥—å');
            try {
                const response = await fetch(`${API_URL}/api/moderation/queue?limit=3`, {
                    headers: {
                        'X-API-Key': API_KEY
                    }
                });
                if (response.ok) {
                    const data = await response.json();
                    const count = data.data ? data.data.length : 0;
                    setResult('test3', true, `–û—á–µ—Ä–µ–¥—å –ø–æ–ª—É—á–µ–Ω–∞! –¢–æ–≤–∞—Ä–æ–≤: ${count}`, data);
                } else {
                    setResult('test3', false, `–û—à–∏–±–∫–∞ HTTP: ${response.status} ${response.statusText}`);
                }
            } catch (error) {
                setResult('test3', false, `–û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`);
            }
        }
        
        async function testCors() {
            setLoading('test4', '–ü—Ä–æ–≤–µ—Ä—è–µ–º CORS');
            try {
                // –ü—Ä–æ–±—É–µ–º OPTIONS –∑–∞–ø—Ä–æ—Å (preflight)
                const response = await fetch(`${API_URL}/api/moderation/stats`, {
                    method: 'OPTIONS',
                    headers: {
                        'Origin': window.location.origin,
                        'Access-Control-Request-Method': 'GET',
                        'Access-Control-Request-Headers': 'X-API-Key'
                    }
                });
                
                const corsHeaders = {
                    'Access-Control-Allow-Origin': response.headers.get('Access-Control-Allow-Origin'),
                    'Access-Control-Allow-Methods': response.headers.get('Access-Control-Allow-Methods'),
                    'Access-Control-Allow-Headers': response.headers.get('Access-Control-Allow-Headers')
                };
                
                setResult('test4', true, `CORS –∑–∞–≥–æ–ª–æ–≤–∫–∏ –ø–æ–ª—É—á–µ–Ω—ã`, corsHeaders);
            } catch (error) {
                setResult('test4', false, `–û—à–∏–±–∫–∞ CORS: ${error.message}`);
            }
        }
        
        function updateSummary() {
            const tests = ['test1', 'test2', 'test3', 'test4'];
            let passed = 0;
            let failed = 0;
            
            tests.forEach(testId => {
                const element = document.getElementById(testId);
                if (element.className.includes('success')) passed++;
                if (element.className.includes('error')) failed++;
            });
            
            const total = tests.length;
            const summary = document.getElementById('summaryText');
            
            if (passed + failed === 0) {
                summary.innerHTML = '–¢–µ—Å—Ç—ã –Ω–µ –∑–∞–ø—É—â–µ–Ω—ã';
            } else {
                summary.innerHTML = `
                    <strong>–ü—Ä–æ–π–¥–µ–Ω–æ: ${passed} –∏–∑ ${total}</strong><br>
                    ‚úÖ –£—Å–ø–µ—à–Ω—ã—Ö: ${passed}<br>
                    ‚ùå –û—à–∏–±–æ–∫: ${failed}<br>
                    ‚è≥ –û–∂–∏–¥–∞–Ω–∏–µ: ${total - passed - failed}
                `;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∏–ª—å summary
                const summaryDiv = document.getElementById('summary');
                if (failed > 0) {
                    summaryDiv.style.borderColor = '#dc3545';
                    summaryDiv.style.background = '#f8d7da';
                } else if (passed === total) {
                    summaryDiv.style.borderColor = '#28a745';
                    summaryDiv.style.background = '#d4edda';
                }
            }
        }
        
        // –ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø–µ—Ä–≤–æ–≥–æ —Ç–µ—Å—Ç–∞
        setTimeout(testHealth, 500);
    </script>
</body>
</html>