#!/bin/bash

# ü§ñ –°–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram –±–æ—Ç–∞ –¥–ª—è —Å–∏—Å—Ç–µ–º—ã –º–æ–¥–µ—Ä–∞—Ü–∏–∏

set -e

echo ""
echo "ü§ñ –ù–ê–°–¢–†–û–ô–ö–ê TELEGRAM –ë–û–¢–ê"
echo "========================="
echo ""

# –¶–≤–µ—Ç–∞
GREEN='\033[0;32m'
BLUE='\033[0;34m'
YELLOW='\033[1;33m'
RED='\033[0;31m'
NC='\033[0m'

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π
check_prerequisites() {
    echo -e "${BLUE}üîç –ü–†–û–í–ï–†–ö–ê –ü–†–ï–î–í–ê–†–ò–¢–ï–õ–¨–ù–´–• –£–°–õ–û–í–ò–ô...${NC}"
    echo ""
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ Node.js
    if ! command -v node &> /dev/null; then
        echo -e "${RED}‚ùå –û—à–∏–±–∫–∞: Node.js –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω${NC}"
        exit 1
    fi
    echo -e "${GREEN}‚úÖ Node.js —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω${NC}"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ npm
    if ! command -v npm &> /dev/null; then
        echo -e "${RED}‚ùå –û—à–∏–±–∫–∞: npm –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω${NC}"
        exit 1
    fi
    echo -e "${GREEN}‚úÖ npm —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω${NC}"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ telegram-bot
    if [ ! -d "telegram-bot" ]; then
        echo -e "${RED}‚ùå –û—à–∏–±–∫–∞: –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è telegram-bot –Ω–µ –Ω–∞–π–¥–µ–Ω–∞${NC}"
        exit 1
    fi
    echo -e "${GREEN}‚úÖ –î–∏—Ä–µ–∫—Ç–æ—Ä–∏—è telegram-bot –Ω–∞–π–¥–µ–Ω–∞${NC}"
    
    echo ""
}

# –®–∞–≥ 1: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –±–æ—Ç–∞
step1_create_bot() {
    echo -e "${BLUE}üìã –®–ê–ì 1: –°–û–ó–î–ê–ù–ò–ï –ë–û–¢–ê –ß–ï–†–ï–ó @BOTFATHER${NC}"
    echo ""
    
    echo "1. –û—Ç–∫—Ä–æ–π—Ç–µ Telegram"
    echo "2. –ù–∞–π–¥–∏—Ç–µ @BotFather"
    echo "3. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É: /newbot"
    echo "4. –£–∫–∞–∂–∏—Ç–µ –∏–º—è –±–æ—Ç–∞: ${YELLOW}Moderation System Bot${NC}"
    echo "5. –£–∫–∞–∂–∏—Ç–µ username –±–æ—Ç–∞ (–¥–æ–ª–∂–µ–Ω –∑–∞–∫–∞–Ω—á–∏–≤–∞—Ç—å—Å—è –Ω–∞ 'bot'):"
    echo "   –ù–∞–ø—Ä–∏–º–µ—Ä: ${YELLOW}moderation_system_bot${NC}"
    echo "6. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ —Ç–æ–∫–µ–Ω, –∫–æ—Ç–æ—Ä—ã–π –æ—Ç–ø—Ä–∞–≤–∏—Ç @BotFather"
    echo ""
    
    echo -e "${YELLOW}üìù –ü—Ä–∏–º–µ—Ä —Ç–æ–∫–µ–Ω–∞:${NC}"
    echo "   1234567890:ABCdefGHIjklMNopQRstUVwxyz-ABCDEFGHIJK"
    echo ""
    
    read -p "–ù–∞–∂–º–∏—Ç–µ Enter –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –±–æ—Ç–∞ –∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è —Ç–æ–∫–µ–Ω–∞..." -r
    echo ""
}

# –®–∞–≥ 2: –í–≤–æ–¥ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞
step2_input_token() {
    echo -e "${BLUE}üìã –®–ê–ì 2: –í–í–û–î –¢–û–ö–ï–ù–ê –ë–û–¢–ê${NC}"
    echo ""
    
    read -p "–í–≤–µ–¥–∏—Ç–µ —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞: " TELEGRAM_BOT_TOKEN
    
    if [ -z "$TELEGRAM_BOT_TOKEN" ]; then
        echo -e "${RED}‚ùå –û—à–∏–±–∫–∞: –¢–æ–∫–µ–Ω –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω${NC}"
        exit 1
    fi
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Ç–æ–∫–µ–Ω–∞
    if [[ ! "$TELEGRAM_BOT_TOKEN" =~ ^[0-9]{8,10}:[a-zA-Z0-9_-]{35}$ ]]; then
        echo -e "${YELLOW}‚ö†Ô∏è  –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: –¢–æ–∫–µ–Ω –∏–º–µ–µ—Ç –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç${NC}"
        echo "   –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (—Ç–æ–∫–µ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ: 123456789:ABCdefGHI...)"
        read -p "   (y/n): " -n 1 -r
        echo ""
        if [[ ! $REPLY =~ ^[Yy]$ ]]; then
            exit 1
        fi
    fi
    
    echo -e "${GREEN}‚úÖ –¢–æ–∫–µ–Ω –ø—Ä–∏–Ω—è—Ç${NC}"
    echo ""
}

# –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ–π –≥—Ä—É–ø–ø—ã
step3_create_group() {
    echo -e "${BLUE}üìã –®–ê–ì 3: –°–û–ó–î–ê–ù–ò–ï –ó–ê–ö–†–´–¢–û–ô –ì–†–£–ü–ü–´${NC}"
    echo ""
    
    echo "1. –í Telegram —Å–æ–∑–¥–∞–π—Ç–µ –Ω–æ–≤—É—é –≥—Ä—É–ø–ø—É:"
    echo "   - –ù–∞–∂–º–∏—Ç–µ '–ù–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ' (–∏–∫–æ–Ω–∫–∞ –∫–∞—Ä–∞–Ω–¥–∞—à–∞)"
    echo "   - –í—ã–±–µ—Ä–∏—Ç–µ '–ù–æ–≤–∞—è –≥—Ä—É–ø–ø–∞'"
    echo "   - –î–æ–±–∞–≤—å—Ç–µ 1-2 —Ç–µ—Å—Ç–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"
    echo "   - –ù–∞–∑–≤–∞–Ω–∏–µ: ${YELLOW}–ú–æ–¥–µ—Ä–∞—Ü–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π - –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ${NC}"
    echo "   - –ù–∞–∂–º–∏—Ç–µ '–°–æ–∑–¥–∞—Ç—å'"
    echo ""
    echo "2. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –≥—Ä—É–ø–ø—É:"
    echo "   - –û—Ç–∫—Ä–æ–π—Ç–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –≥—Ä—É–ø–ø–µ"
    echo "   - –ù–∞–∂–º–∏—Ç–µ '–ò–∑–º–µ–Ω–∏—Ç—å'"
    echo "   - –î–æ–±–∞–≤—å—Ç–µ –æ–ø–∏—Å–∞–Ω–∏–µ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)"
    echo "   - –í–∫–ª—é—á–∏—Ç–µ '–ó–∞–∫—Ä—ã—Ç–∞—è –≥—Ä—É–ø–ø–∞'"
    echo ""
    echo "3. –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞ –≤ –≥—Ä—É–ø–ø—É:"
    echo "   - –í –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≥—Ä—É–ø–ø–µ –Ω–∞–∂–º–∏—Ç–µ '–î–æ–±–∞–≤–∏—Ç—å —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤'"
    echo "   - –í–≤–µ–¥–∏—Ç–µ username –±–æ—Ç–∞: ${YELLOW}@moderation_system_bot${NC}"
    echo "   - –î–æ–±–∞–≤—å—Ç–µ –±–æ—Ç–∞"
    echo ""
    echo "4. –ù–∞–∑–Ω–∞—á—å—Ç–µ –±–æ—Ç—É –ø—Ä–∞–≤–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞:"
    echo "   - –ù–∞–π–¥–∏—Ç–µ –±–æ—Ç–∞ –≤ —Å–ø–∏—Å–∫–µ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤"
    echo "   - –ù–∞–∂–º–∏—Ç–µ –Ω–∞ –±–æ—Ç–∞ ‚Üí '–ù–∞–∑–Ω–∞—á–∏—Ç—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º'"
    echo "   - –í–∫–ª—é—á–∏—Ç–µ –≤—Å–µ –ø—Ä–∞–≤–∞ (–æ—Å–æ–±–µ–Ω–Ω–æ '–û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è')"
    echo "   - –ù–∞–∂–º–∏—Ç–µ '–°–æ—Ö—Ä–∞–Ω–∏—Ç—å'"
    echo ""
    
    read -p "–ù–∞–∂–º–∏—Ç–µ Enter –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã –∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –±–æ—Ç–∞..." -r
    echo ""
}

# –®–∞–≥ 4: –ü–æ–ª—É—á–µ–Ω–∏–µ ID –≥—Ä—É–ø–ø—ã
step4_get_chat_id() {
    echo -e "${BLUE}üìã –®–ê–ì 4: –ü–û–õ–£–ß–ï–ù–ò–ï ID –ì–†–£–ü–ü–´${NC}"
    echo ""
    
    echo "1. –î–æ–±–∞–≤—å—Ç–µ @userinfobot –≤ –≥—Ä—É–ø–ø—É"
    echo "2. –û—Ç–ø—Ä–∞–≤—å—Ç–µ –∫–æ–º–∞–Ω–¥—É: /start"
    echo "3. –ë–æ—Ç –ø–æ–∫–∞–∂–µ—Ç ID –≥—Ä—É–ø–ø—ã –≤ —Ñ–æ—Ä–º–∞—Ç–µ:"
    echo "   ${YELLOW}Chat ID: -1001234567890${NC}"
    echo "4. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ ID (—á–∏—Å–ª–æ –ø–æ—Å–ª–µ 'Chat ID:')"
    echo ""
    
    read -p "–í–≤–µ–¥–∏—Ç–µ Chat ID –≥—Ä—É–ø–ø—ã (–Ω–∞–ø—Ä–∏–º–µ—Ä: -1001234567890): " TELEGRAM_CHAT_ID
    
    if [ -z "$TELEGRAM_CHAT_ID" ]; then
        echo -e "${RED}‚ùå –û—à–∏–±–∫–∞: Chat ID –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω${NC}"
        exit 1
    fi
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ Chat ID
    if [[ ! "$TELEGRAM_CHAT_ID" =~ ^-100[0-9]{10}$ ]] && [[ ! "$TELEGRAM_CHAT_ID" =~ ^-[0-9]{10,}$ ]]; then
        echo -e "${YELLOW}‚ö†Ô∏è  –ü—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ: Chat ID –∏–º–µ–µ—Ç –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç${NC}"
        echo "   –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å? (–æ–±—ã—á–Ω–æ Chat ID –Ω–∞—á–∏–Ω–∞–µ—Ç—Å—è —Å -100)"
        read -p "   (y/n): " -n 1 -r
        echo ""
        if [[ ! $REPLY =~ ^[Yy]$ ]]; then
            exit 1
        fi
    fi
    
    echo -e "${GREEN}‚úÖ Chat ID –ø—Ä–∏–Ω—è—Ç${NC}"
    echo ""
}

# –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
step5_setup_environment() {
    echo -e "${BLUE}üìã –®–ê–ì 5: –ù–ê–°–¢–†–û–ô–ö–ê –û–ö–†–£–ñ–ï–ù–ò–Ø${NC}"
    echo ""
    
    # –°–æ–∑–¥–∞–µ–º .env.development –µ—Å–ª–∏ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
    if [ ! -f ".env.development" ]; then
        echo "–°–æ–∑–¥–∞—é .env.development –∏–∑ .env.example..."
        cp .env.example .env.development
        echo -e "${GREEN}‚úÖ –§–∞–π–ª —Å–æ–∑–¥–∞–Ω${NC}"
    fi
    
    # –û–±–Ω–æ–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram
    echo "–û–±–Ω–æ–≤–ª—è—é –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram –≤ .env.development..."
    
    # –°–æ–∑–¥–∞–µ–º –≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ–∞–π–ª
    TEMP_FILE=$(mktemp)
    
    # –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º .env.development
    while IFS= read -r line; do
        if [[ "$line" == TELEGRAM_BOT_TOKEN=* ]]; then
            echo "TELEGRAM_BOT_TOKEN=$TELEGRAM_BOT_TOKEN"
        elif [[ "$line" == TELEGRAM_CHAT_ID=* ]]; then
            echo "TELEGRAM_CHAT_ID=$TELEGRAM_CHAT_ID"
        elif [[ "$line" == TELEGRAM_BOT_USERNAME=* ]]; then
            # –ò–∑–≤–ª–µ–∫–∞–µ–º username –∏–∑ —Ç–æ–∫–µ–Ω–∞ (–ø–µ—Ä–≤–∞—è —á–∞—Å—Ç—å –¥–æ :)
            BOT_USERNAME="moderation_system_bot"
            echo "TELEGRAM_BOT_USERNAME=$BOT_USERNAME"
        else
            echo "$line"
        fi
    done < .env.development > "$TEMP_FILE"
    
    # –î–æ–±–∞–≤–ª—è–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –µ—Å–ª–∏ –∏—Ö –Ω–µ—Ç
    if ! grep -q "TELEGRAM_BOT_TOKEN=" "$TEMP_FILE"; then
        echo "TELEGRAM_BOT_TOKEN=$TELEGRAM_BOT_TOKEN" >> "$TEMP_FILE"
    fi
    
    if ! grep -q "TELEGRAM_CHAT_ID=" "$TEMP_FILE"; then
        echo "TELEGRAM_CHAT_ID=$TELEGRAM_CHAT_ID" >> "$TEMP_FILE"
    fi
    
    if ! grep -q "TELEGRAM_BOT_USERNAME=" "$TEMP_FILE"; then
        echo "TELEGRAM_BOT_USERNAME=moderation_system_bot" >> "$TEMP_FILE"
    fi
    
    # –ó–∞–º–µ–Ω—è–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π —Ñ–∞–π–ª
    mv "$TEMP_FILE" .env.development
    
    echo -e "${GREEN}‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram –æ–±–Ω–æ–≤–ª–µ–Ω—ã${NC}"
    echo ""
    
    # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
    echo -e "${YELLOW}üìù –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ Telegram:${NC}"
    grep -E "TELEGRAM_" .env.development
    echo ""
}

# –®–∞–≥ 6: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –±–æ—Ç–∞
step6_install_dependencies() {
    echo -e "${BLUE}üìã –®–ê–ì 6: –£–°–¢–ê–ù–û–í–ö–ê –ó–ê–í–ò–°–ò–ú–û–°–¢–ï–ô –ë–û–¢–ê${NC}"
    echo ""
    
    echo "–£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –¥–ª—è Telegram –±–æ—Ç–∞..."
    cd telegram-bot
    
    if [ ! -f "package.json" ]; then
        echo -e "${RED}‚ùå –û—à–∏–±–∫–∞: package.json –Ω–µ –Ω–∞–π–¥–µ–Ω${NC}"
        exit 1
    fi
    
    npm install
    echo -e "${GREEN}‚úÖ –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã${NC}"
    
    cd ..
    echo ""
}

# –®–∞–≥ 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞
step7_test_bot() {
    echo -e "${BLUE}üìã –®–ê–ì 7: –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï –ë–û–¢–ê${NC}"
    echo ""
    
    echo "1. –ó–∞–ø—É—Å–∫–∞—é –±–æ—Ç–∞ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ..."
    cd telegram-bot
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ –≤ —Ñ–æ–Ω–µ
    TELEGRAM_BOT_TOKEN="$TELEGRAM_BOT_TOKEN" \
    TELEGRAM_CHAT_ID="$TELEGRAM_CHAT_ID" \
    npm start &
    
    BOT_PID=$!
    echo "   PID –±–æ—Ç–∞: $BOT_PID"
    
    # –î–∞–µ–º –±–æ—Ç—É –≤—Ä–µ–º—è –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è
    echo "   –ñ–¥—É 5 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞..."
    sleep 5
    
    cd ..
    
    echo -e "${GREEN}‚úÖ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω${NC}"
    echo ""
    
    echo "2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è..."
    echo "   –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤ –≥—Ä—É–ø–ø—É –∫–æ–º–∞–Ω–¥—É: ${YELLOW}/start${NC}"
    echo "   –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–≤–µ—Ç–∏—Ç—å –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º"
    echo ""
    
    read -p "–ù–∞–∂–º–∏—Ç–µ Enter –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ /start –∏ –ø—Ä–æ–≤–µ—Ä–∫–∏ –æ—Ç–≤–µ—Ç–∞..." -r
    echo ""
    
    echo "3. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π..."
    echo "   –ó–∞–ø—É—Å–∫–∞—é —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–¥–µ—Ä–∞—Ü–∏–∏..."
    
    # –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç
    if [ -f "test_simple.sh" ]; then
        ./test_simple.sh > /dev/null 2>&1 &
        echo "   –¢–µ—Å—Ç–æ–≤–∞—è –º–æ–¥–µ—Ä–∞—Ü–∏—è –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞"
    else
        echo -e "${YELLOW}‚ö†Ô∏è  –¢–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–ø—É—Å–∫–∞—é...${NC}"
    fi
    
    echo "   –ë–æ—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—É"
    echo "   –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≥—Ä—É–ø–ø—É —á–µ—Ä–µ–∑ 10-15 —Å–µ–∫—É–Ω–¥"
    echo ""
    
    read -p "–ù–∞–∂–º–∏—Ç–µ Enter –ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è..." -r
    echo ""
    
    # –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –±–æ—Ç–∞
    echo "4. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é –±–æ—Ç–∞..."
    kill $BOT_PID 2>/dev/null || true
    echo -e "${GREEN}‚úÖ –ë–æ—Ç –æ—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω${NC}"
    echo ""
}

# –®–∞–≥ 8: –§–∏–Ω–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
step8_final_setup() {
    echo -e "${BLUE}üìã –®–ê–ì 8: –§–ò–ù–ê–õ–¨–ù–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê${NC}"
    echo ""
    
    echo "1. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–æ–º–∞–Ω–¥ –±–æ—Ç–∞ —á–µ—Ä–µ–∑ @BotFather:"
    echo "   –û—Ç–ø—Ä–∞–≤—å—Ç–µ @BotFather –∫–æ–º–∞–Ω–¥—É: /setcommands"
    echo "   –í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à–µ–≥–æ –±–æ—Ç–∞"
    echo "   –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Å–ø–∏—Å–æ–∫ –∫–æ–º–∞–Ω–¥:"
    echo ""
    cat << 'EOF'
start - –ó–∞–ø—É—Å—Ç–∏—Ç—å –±–æ—Ç–∞
help - –ü–æ–º–æ—â—å –∏ –∫–æ–º–∞–Ω–¥—ã
stats - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–æ–¥–µ—Ä–∞—Ü–∏–π
queue - –¢–µ–∫—É—â–∞—è –æ—á–µ—Ä–µ–¥—å
settings - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–æ–≤)
EOF
    echo ""
    
    echo "2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–ø–∏—Å–∞–Ω–∏—è –±–æ—Ç–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ):"
    echo "   /setdescription - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ"
    echo "   /setabouttext - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–µ–∫—Å—Ç '–û –±–æ—Ç–µ'"
    echo "   /setuserpic - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∞–≤–∞—Ç–∞—Ä"
    echo ""
    
    echo "3. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–æ—Ç–∞ –≤ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫:"
    echo "   –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –±–æ—Ç–∞ –¥–æ–±–∞–≤—å—Ç–µ –≤ crontab:"
    echo "   @reboot cd /–ø—É—Ç—å/–∫/moderation-system && ./manage.sh start"
    echo ""
    
    read -p "–ù–∞–∂–º–∏—Ç–µ Enter —á—Ç–æ–±—ã –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å..." -r
    echo ""
}

# –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è
main() {
    echo -e "${BLUE}üöÄ –ó–ê–ü–£–°–ö –ù–ê–°–¢–†–û–ô–ö–ò TELEGRAM –ë–û–¢–ê${NC}"
    echo ""
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã—Ö —É—Å–ª–æ–≤–∏–π
    check_prerequisites
    
    # –®–∞–≥ 1: –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ —Å–æ–∑–¥–∞–Ω–∏—é –±–æ—Ç–∞
    step1_create_bot
    
    # –®–∞–≥ 2: –í–≤–æ–¥ —Ç–æ–∫–µ–Ω–∞ –±–æ—Ç–∞
    step2_input_token
    
    # –®–∞–≥ 3: –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ–π –≥—Ä—É–ø–ø—ã
    step3_create_group
    
    # –®–∞–≥ 4: –ü–æ–ª—É—á–µ–Ω–∏–µ ID –≥—Ä—É–ø–ø—ã
    step4_get_chat_id
    
    # –®–∞–≥ 5: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
    step5_setup_environment
    
    # –®–∞–≥ 6: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –±–æ—Ç–∞
    step6_install_dependencies
    
    # –®–∞–≥ 7: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ—Ç–∞
    step7_test_bot
    
    # –®–∞–≥ 8: –§–∏–Ω–∞–ª—å–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
    step8_final_setup
    
    # –§–∏–Ω–∞–ª—å–Ω—ã–π –æ—Ç—á–µ—Ç
    echo -e "${GREEN}========================================${NC}"
    echo -e "${GREEN}üéâ –ù–ê–°–¢–†–û–ô–ö–ê TELEGRAM –ë–û–¢–ê –ó–ê–í–ï–†–®–ï–ù–ê!${NC}"
    echo -e "${GREEN}========================================${NC}"
    echo ""
    
    echo -e "${BLUE}üìã –°–í–û–î–ö–ê –ù–ê–°–¢–†–û–ï–ö:${NC}"
    echo "   –¢–æ–∫–µ–Ω –±–æ—Ç–∞: ${TELEGRAM_BOT_TOKEN:0:15}..."
    echo "   Chat ID –≥—Ä—É–ø–ø—ã: $TELEGRAM_CHAT_ID"
    echo "   –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏: .env.development"
    echo ""
    
    echo -e "${BLUE}üöÄ –ö–ê–ö –ó–ê–ü–£–°–¢–ò–¢–¨ –ë–û–¢–ê:${NC}"
    echo "   1. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å—é —Å–∏—Å—Ç–µ–º—É:"
    echo "      ${YELLOW}./manage.sh start${NC}"
    echo ""
    echo "   2. –ò–ª–∏ —Ç–æ–ª—å–∫–æ Telegram –±–æ—Ç–∞:"
    echo "      ${YELLOW}cd telegram-bot && npm start${NC}"
    echo ""
    
    echo -e "${BLUE}üîß –ö–û–ú–ê–ù–î–´ –î–õ–Ø –£–ü–†–ê–í–õ–ï–ù–ò–Ø:${NC}"
    echo "   ./manage.sh start    - –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º—É"
    echo "   ./manage.sh stop     - –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–∏—Å—Ç–µ–º—É"
    echo "   ./manage.sh restart  - –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å —Å–∏—Å—Ç–µ–º—É"
    echo "   ./manage.sh logs     - –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤"
}
