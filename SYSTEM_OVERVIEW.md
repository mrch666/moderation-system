# Обзор системы модерации изображений товаров

## Архитектура системы

### Компоненты системы:
1. **Backend API** (Node.js/Express)
   - Обработка REST API запросов
   - Управление очередью модерации
   - Работа с базой данных
   - Аутентификация и авторизация

2. **Frontend** (React/Ant Design)
   - Веб-интерфейс для администраторов
   - Просмотр очереди модерации
   - Управление настройками системы
   - Статистика и отчеты

3. **Telegram бот** (Node.js/Telegraf)
   - Уведомления о новых модерациях
   - Быстрая модерация через кнопки
   - Команды для управления системой
   - Интеграция с администраторами

4. **База данных** (PostgreSQL)
   - Хранение данных модераций
   - Настройки системы
   - Пользователи и права доступа
   - Логи действий

5. **Кэш и очереди** (Redis)
   - Кэширование запросов
   - Управление очередями
   - Сессии пользователей

## Основные функции

### 1. Отправка на модерацию
- Прием изображений по ссылкам
- Связь с ID товара
- URL для загрузки на сервер
- Метаданные (опционально)

### 2. Очередь модерации
- Список изображений на проверку
- Фильтрация по статусу и дате
- Быстрое одобрение/отклонение
- Назначение модераторов

### 3. Управление настройками
- API ключи для интеграций
- Telegram чаты для уведомлений
- Параметры загрузки файлов
- Настройки уведомлений

### 4. Администрирование
- Управление пользователями
- Назначение ролей (админ/модератор)
- Просмотр логов действий
- Мониторинг системы

### 5. Интеграция с Telegram
- Уведомления в реальном времени
- Модерация через inline-кнопки
- Статистика через команды
- Управление настройками

## Поток данных

### 1. Отправка изображения:
```
Клиент → API → Валидация → База данных → Уведомление в Telegram
```

### 2. Процесс модерации:
```
Telegram уведомление → Модератор → Решение → Обновление статуса → Уведомление клиента
```

### 3. Веб-интерфейс:
```
Администратор → Frontend → API → База данных → Отображение результатов
```

## API Endpoints

### Модерация:
- `POST /api/moderation/submit` - отправка на модерацию
- `GET /api/moderation/status/:uuid` - проверка статуса
- `GET /api/moderation/queue` - получение очереди
- `PUT /api/moderation/:id/moderate` - изменение статуса
- `GET /api/moderation/search` - поиск модераций
- `GET /api/moderation/stats` - статистика

### Настройки:
- `GET /api/settings` - все настройки
- `PUT /api/settings/:key` - обновление настройки
- `GET /api/settings/api-keys` - список API ключей
- `POST /api/settings/api-keys` - создание ключа
- `GET /api/settings/telegram-chats` - Telegram чаты
- `POST /api/settings/telegram-chats` - добавление чата
- `GET /api/settings/users` - список пользователей
- `PUT /api/settings/users/:id/role` - изменение роли

### Аутентификация:
- `POST /api/auth/api-key` - получение JWT токена
- `POST /api/auth/validate` - проверка токена
- `GET /api/auth/me` - информация о пользователе
- `POST /api/auth/refresh` - обновление токена
- `POST /api/auth/logout` - выход из системы

## База данных

### Основные таблицы:

#### moderations (модерации)
- id, moderation_uuid
- image_url, product_id, download_url
- status (pending/approved/rejected/processing)
- submitted_at, moderated_at, moderator_id
- metadata (JSON)

#### users (пользователи)
- id, telegram_id, username
- first_name, last_name, role
- created_at, last_active, is_active

#### settings (настройки)
- key, value, description
- category, created_at, updated_at

#### api_keys (API ключи)
- key, name, user_id
- permissions, is_active
- created_at, last_used, expires_at

#### telegram_chats (Telegram чаты)
- chat_id, chat_type, title
- username, is_active, settings
- created_at, updated_at

#### moderation_logs (логи модераций)
- moderation_id, user_id, action
- details, ip_address, user_agent
- created_at

## Безопасность

### Меры защиты:
1. **Аутентификация** - API ключи и JWT токены
2. **Авторизация** - ролевая модель (админ/модератор/пользователь)
3. **Валидация** - проверка всех входных данных
4. **Логирование** - запись всех действий
5. **Rate limiting** - ограничение частоты запросов
6. **HTTPS** - шифрование трафика (в production)

### Права доступа:
- **Администратор**: полный доступ ко всем функциям
- **Модератор**: просмотр очереди, модерация, базовая статистика
- **Пользователь**: только отправка на модерацию и проверка статуса

## Масштабируемость

### Вертикальное масштабирование:
- Увеличение ресурсов серверов
- Оптимизация запросов к базе данных
- Кэширование часто запрашиваемых данных

### Горизонтальное масштабирование:
- Балансировка нагрузки между инстансами backend
- Репликация базы данных
- Redis кластер для кэша
- CDN для статических файлов

## Мониторинг

### Метрики для отслеживания:
1. **Производительность**:
   - Время ответа API
   - Количество запросов в секунду
   - Использование CPU/памяти

2. **Бизнес-метрики**:
   - Количество модераций в день
   - Среднее время модерации
   - Процент одобренных/отклоненных
   - Активность модераторов

3. **Ошибки**:
   - Количество ошибок API
   - Ошибки базы данных
   - Ошибки интеграций

### Инструменты:
- Логи приложения
- Мониторинг базы данных
- Uptime мониторинг
- Алертинг при проблемах

## Развертывание

### Варианты развертывания:
1. **Docker Compose** - для разработки и небольших проектов
2. **Kubernetes** - для production с высокой нагрузкой
3. **Ручная установка** - для полного контроля

### Требования к инфраструктуре:
- Сервер с 2+ ядрами CPU
- 4+ GB RAM
- 50+ GB дискового пространства
- Стабильное интернет-соединение

## Интеграции

### Поддерживаемые интеграции:
1. **E-commerce платформы** - через REST API
2. **Telegram** - для уведомлений и модерации
3. **Веб-сайты** - через iframe или API
4. **Мобильные приложения** - через REST API

### Планируемые интеграции:
1. **Slack** - уведомления и модерация
2. **Discord** - уведомления и модерация
3. **Email** - уведомления о статусе
4. **Webhooks** - события в реальном времени

## Разработка

### Технологический стек:
- **Backend**: Node.js, Express, PostgreSQL, Redis
- **Frontend**: React, Ant Design, React Query
- **Telegram бот**: Telegraf, Axios
- **Инфраструктура**: Docker, Nginx

### Процесс разработки:
1. Локальная разработка с Docker
2. Тестирование на staging окружении
3. Code review и автоматические тесты
4. Развертывание на production

### Тестирование:
- Unit тесты для бизнес-логики
- Интеграционные тесты для API
- E2E тесты для фронтенда
- Нагрузочное тестирование

## Поддержка и обслуживание

### Регулярные задачи:
1. **Резервное копирование** - ежедневно
2. **Обновление зависимостей** - еженедельно
3. **Очистка старых данных** - ежемесячно
4. **Анализ логов** - постоянно

### Обновление системы:
1. Тестирование на staging
2. Резервное копирование production
3. Поэтапное развертывание
4. Мониторинг после обновления

## Дорожная карта

### Ближайшие улучшения:
1. Поддержка пакетной загрузки изображений
2. AI-анализ изображений (автоматическая модерация)
3. Расширенная аналитика и отчеты
4. Мобильное приложение для модераторов

### Долгосрочные планы:
1. Поддержка видео модерации
2. Интеграция с CRM системами
3. Мультиязычный интерфейс
4. Расширенная система прав доступа

## Заключение

Система модерации изображений товаров предоставляет:
- Гибкий REST API для интеграций
- Удобный веб-интерфейс для администраторов
- Мгновенные уведомления через Telegram
- Масштабируемую архитектуру
- Высокий уровень безопасности

Система подходит для:
- Интернет-магазинов
- Маркетплейсов
- Социальных сетей
- Любых проектов, требующих модерации контента