#!/bin/bash

echo "=== ะะะะะะฏ ะะะะะะะกะขะะะ ะฆะะะะงะะ ==="
echo ""

# 1. ะัะพะฒะตัะบะฐ backend
echo "1. ๐ ะะะะะะะะ BACKEND API..."
curl -s "http://localhost:3000/health" && echo ""
echo ""

# 2. ะกะพะทะดะฐะฝะธะต ัะตััะพะฒะพะน ะผะพะดะตัะฐัะธะธ ั ะะงะะะฌ ะะะะกะขะซะะ ะดะฐะฝะฝัะผะธ
echo "2. ๐ ะกะะะะะะะ ะขะะกะขะะะะ ะะะะะะะฆะะ..."
TEST_ID="simple-test-$(date +%s)"
JSON_DATA="{\"product_id\":\"$TEST_ID\",\"image_url\":\"https://example.com/test.jpg\",\"download_url\":\"https://example.com/test.jpg\",\"metadata\":{\"title\":\"ะะะะกะขะะ ะขะะกะข\",\"description\":\"ะัะตะฝั ะฟัะพััะพะต ะพะฟะธัะฐะฝะธะต\",\"price\":\"100 ััะฑ.\",\"category\":\"ะขะตัั\"}}"

echo "๐ฆ ะัะฟัะฐะฒะปัะตะผัะต ะดะฐะฝะฝัะต:"
echo "$JSON_DATA" | python3 -m json.tool
echo ""

RESPONSE=$(curl -s -X POST "http://localhost:3000/api/moderation/submit" \
  -H "Content-Type: application/json" \
  -H "X-API-Key: test_api_key_123456" \
  -d "$JSON_DATA")

echo "๐จ ะัะฒะตั ัะตัะฒะตัะฐ:"
echo "$RESPONSE" | python3 -m json.tool 2>/dev/null || echo "$RESPONSE"

MODERATION_ID=$(echo "$RESPONSE" | grep -o '"moderation_id":"[^"]*"' | cut -d'"' -f4)
echo ""
echo "โ ะะพะดะตัะฐัะธั ัะพะทะดะฐะฝะฐ! ID: $MODERATION_ID"
echo ""

# 3. ะัะพะฒะตัะบะฐ ะพัะตัะตะดะธ
echo "3. ๐ ะะะะะะะะ ะะงะะะะะ..."
sleep 3
curl -s "http://localhost:3000/api/moderation/queue?limit=3" -H "X-API-Key: test_api_key_123456" | python3 -m json.tool 2>/dev/null || echo "ะัะธะฑะบะฐ ะฟะพะปััะตะฝะธั ะพัะตัะตะดะธ"
echo ""

# 4. ะัะพะฒะตัะบะฐ ะปะพะณะพะฒ
echo "4. ๐ ะะะะะะะะ ะะะะะ BACKEND..."
echo "ะะพัะปะตะดะฝะธะต 20 ัััะพะบ ะปะพะณะพะฒ:"
tail -20 backend/backend.log 2>/dev/null | grep -A5 -B5 "$MODERATION_ID" || echo "ะะพะณะธ ะดะปั ััะพะน ะผะพะดะตัะฐัะธะธ ะฝะต ะฝะฐะนะดะตะฝั"
echo ""

# 5. ะะฝััััะบัะธั
echo "5. ๐ฑ ะงะขะ ะะะะะะะะขะฌ ะ TELEGRAM:"
echo ""
echo "   ะะะะะะ ะะะะะขะ ะกะะะะฉะะะะ ะก:"
echo "   - ๐ข ะะฐะณะพะปะพะฒะพะบ: ะะะะะฏ ะะะะะะะฆะะฏ!"
echo "   - ๐ ID: $MODERATION_ID"
echo "   - ๐ฆ ะขะพะฒะฐั: $TEST_ID"
echo "   - ๐ท๏ธ ะะฐะทะฒะฐะฝะธะต: ะะะะกะขะะ ะขะะกะข"
echo "   - ๐ ะะฟะธัะฐะฝะธะต: ะัะตะฝั ะฟัะพััะพะต ะพะฟะธัะฐะฝะธะต"
echo "   - ๐ฐ ะฆะตะฝะฐ: 100 ััะฑ."
echo "   - ๐ ะะฐัะตะณะพัะธั: ะขะตัั"
echo "   - โฌ๏ธ ะะะะะะ ะะะ ะกะะะะฉะะะะะ:"
echo "     [โ ะะดะพะฑัะธัั] [โ ะัะบะปะพะฝะธัั]"
echo ""
echo "๐ง ะะกะะ ะะะข ะะะะะะ ะะะ ะะะะะะะะฏ:"
echo "1. ะัะพะฒะตัััะต ะปะพะณะธ ะฒััะต ะฝะฐ ะพัะธะฑะบะธ"
echo "2. ะัะพะฒะตัััะต ะฟะตัะตะผะตะฝะฝัะต ะพะบััะถะตะฝะธั Telegram"
echo "3. ะัะพะฒะตัััะต ัะพัะผะฐั metadata ะฒ ะทะฐะฟัะพัะต"
echo ""
echo "๐ฏ ะะะะฃะะฌะขะะข ะะะะะะะกะขะะะ ะะฃะะะข ะ ะะะะะฅ ะะซะจะ!"