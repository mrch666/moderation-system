#!/bin/bash

echo "=== –§–ò–ù–ê–õ–¨–ù–´–ô –¢–ï–°–¢ –ö–ù–û–ü–û–ö ==="
echo ""

# –°–æ–∑–¥–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π JSON —Å –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–º–∏
JSON_DATA='{
  "product_id": "final-buttons-test-'$(date +%s)'",
  "image_url": "https://via.placeholder.com/800x600/00BCD4/FFFFFF?text=Final+Buttons+Test",
  "download_url": "https://via.placeholder.com/800x600/00BCD4/FFFFFF?text=Final+Buttons+Test",
  "metadata": {
    "title": "–§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –∫–Ω–æ–ø–æ–∫ –≤ Telegram",
    "description": "–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –¥–≤—É—Ö —Å–æ–æ–±—â–µ–Ω–∏–π: –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è + –∫–Ω–æ–ø–∫–∏ –æ—Ç–¥–µ–ª—å–Ω–æ",
    "price": "9999 —Ä—É–±.",
    "category": "–§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"
  }
}'

echo "üìã JSON –¥–∞–Ω–Ω—ã–µ:"
echo "$JSON_DATA" | python3 -m json.tool
echo ""

echo "üöÄ –û—Ç–ø—Ä–∞–≤–ª—è—é –∑–∞–ø—Ä–æ—Å –Ω–∞ —Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ—Ä–∞—Ü–∏–∏..."
RESPONSE=$(curl -s -X POST "http://localhost:3000/api/moderation/submit" \
  -H "Content-Type: application/json" \
  -H "X-API-Key: test_api_key_123456" \
  -d "$JSON_DATA")

echo "üì® –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:"
echo "$RESPONSE" | python3 -m json.tool 2>/dev/null || echo "$RESPONSE"

MODERATION_ID=$(echo "$RESPONSE" | grep -o '"moderation_id":"[^"]*"' | cut -d'"' -f4)

echo ""
echo "‚úÖ –ú–æ–¥–µ—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞! ID: $MODERATION_ID"
echo ""
echo "üì± –û–ñ–ò–î–ê–ï–ú–û–ï –í TELEGRAM –ì–†–£–ü–ü–ï:"
echo ""
echo "=== –°–û–û–ë–©–ï–ù–ò–ï 1 (–ò–ù–§–û–†–ú–ê–¶–ò–Ø) ==="
echo "üì¢ –ù–û–í–ê–Ø –ú–û–î–ï–†–ê–¶–ò–Ø!"
echo "üÜî ID: $MODERATION_ID"
echo "üì¶ –¢–æ–≤–∞—Ä: final-buttons-test-..."
echo "üè∑Ô∏è –ù–∞–∑–≤–∞–Ω–∏–µ: –§–∏–Ω–∞–ª—å–Ω—ã–π —Ç–µ—Å—Ç –∫–Ω–æ–ø–æ–∫ –≤ Telegram"
echo "üìù –û–ø–∏—Å–∞–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –¥–≤—É—Ö —Å–æ–æ–±—â–µ–Ω–∏–π..."
echo "üí∞ –¶–µ–Ω–∞: 9999 —Ä—É–±."
echo "üìÇ –ö–∞—Ç–µ–≥–æ—Ä–∏—è: –§–∏–Ω–∞–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ"
echo "üïê –í—Ä–µ–º—è: —Ç–µ–∫—É—â–µ–µ"
echo "üîó –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ: https://via.placeholder.com/..."
echo ""
echo "=== –°–û–û–ë–©–ï–ù–ò–ï 2 (–¢–û–õ–¨–ö–û –ö–ù–û–ü–ö–ò) ==="
echo "‚ö° –î–µ–π—Å—Ç–≤–∏—è:"
echo ""
echo "‚¨áÔ∏è –ü–û–î –í–¢–û–†–´–ú –°–û–û–ë–©–ï–ù–ò–ï–ú –î–û–õ–ñ–ù–´ –ë–´–¢–¨ –ö–ù–û–ü–ö–ò:"
echo "‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê"
echo "‚îÇ [‚úÖ –û–¥–æ–±—Ä–∏—Ç—å]  [‚ùå –û—Ç–∫–ª–æ–Ω–∏—Ç—å] ‚îÇ"
echo "‚îÇ [üëÅÔ∏è –î–µ—Ç–∞–ª–∏]   [üìã –û—á–µ—Ä–µ–¥—å]   ‚îÇ"
echo "‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò"
echo ""
echo "‚è≥ –ñ–¥—É 10 —Å–µ–∫—É–Ω–¥ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏..."
sleep 10
echo ""
echo "üìã –ü–†–û–í–ï–†–Ø–Æ –õ–û–ì–ò BACKEND:"
tail -10 backend/backend.log 2>/dev/null | grep -A5 -B5 "$MODERATION_ID" || echo "–õ–æ–≥–∏ –¥–ª—è —ç—Ç–æ–π –º–æ–¥–µ—Ä–∞—Ü–∏–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã"
echo ""
echo "üéØ –ß–¢–û –ü–†–û–í–ï–†–ò–¢–¨ –í TELEGRAM:"
echo "1. –ü—Ä–∏—à–ª–∏ –ª–∏ –î–í–ê —Å–æ–æ–±—â–µ–Ω–∏—è?"
echo "2. –ï—Å—Ç—å –ª–∏ –∫–Ω–æ–ø–∫–∏ –ø–æ–¥ –≤—Ç–æ—Ä—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º?"
echo "3. –í—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞?"
echo ""
echo "üîß –ï–°–õ–ò –ö–ù–û–ü–û–ö –ù–ï–¢:"
echo "1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏: tail -f backend/backend.log"
echo "2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—à–∏–±–∫–∏ Telegram API"
echo "3. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —É–ø—Ä–æ—Å—Ç–∏—Ç—å callback_data"